#!/usr/bin/env python

from gpgtweet.client import client 

class bcolors:
    HEADER = '\033[95m'
    BLUE = '\033[94m'
    GREEN = '\033[92m'
    WARNING = '\033[93m'
    FAIL = '\033[91m'
    ENDC = '\033[0m'

def confirm(prompt='Confirm', resp=False):

    prompt = '%s [%s]|%s: ' % (prompt, 'n', 'y')
    if resp:
        prompt = '%s [%s]|%s: ' % (prompt, 'y', 'n')

    while True:
        ans = raw_input(prompt)
        if not ans:
            return resp
        if ans not in ['y', 'Y', 'n', 'N']:
            print("please enter y or n.")
            continue
        if ans == 'y' or ans == 'Y':
            return True
        if ans == 'n' or ans == 'N':
            return False

def confirm_messages(message, signed_message):
    print("\nTweet:\n%s%s%s\n\nSigned Message:\n%s%s%s\n" % (bcolors.BLUE, message, bcolors.ENDC,
                                                             bcolors.BLUE, signed_message, bcolors.ENDC))
    prompt = "%sConfirm and Send?%s" % (bcolors.FAIL, bcolors.ENDC)
    return confirm(prompt=prompt)

client = client.GPGTweetClient()
while not client.check_twitter_auth():
    print("Client is not authorized")
    client.oob_auth()
    client.config.write()
confirmed = False
while not confirmed:
    (message, signed_message) = client.set_message()
    confirmed = confirm_messages(message, signed_message)
client.set_status(message, signed_message)
