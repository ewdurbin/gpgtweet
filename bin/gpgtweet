#!/usr/bin/env python

from gpgtweet.client import client 
from string import Template

class bcolors:
    HEADER = '\033[95m'
    BLUE = '\033[94m'
    GREEN = '\033[92m'
    WARNING = '\033[93m'
    FAIL = '\033[91m'
    ENDC = '\033[0m'

confirm_template = Template("""Tweet:
$color_open$message$close
Signed By:
$color_open$signed_by$close
Signed Message:
$color_open$signed_message$close
""")

def confirm(prompt='Confirm', resp=False):

    prompt = '%s [%s]|%s: ' % (prompt, 'n', 'y')
    if resp:
        prompt = '%s [%s]|%s: ' % (prompt, 'y', 'n')

    while True:
        ans = raw_input(prompt)
        if not ans:
            return resp
        if ans not in ['y', 'Y', 'n', 'N']:
            print("please enter y or n.")
            continue
        if ans == 'y' or ans == 'Y':
            return True
        if ans == 'n' or ans == 'N':
            return False

def confirm_messages(message, signed_by, signed_message):
    print(confirm_template.substitute(color_open=bcolors.BLUE,
                                      close=bcolors.ENDC,
                                      message=message,
                                      signed_by=signed_by,
                                      signed_message=signed_message))
    prompt = "%sConfirm and Send?%s" % (bcolors.FAIL, bcolors.ENDC)
    return confirm(prompt=prompt)

client = client.GPGTweetClient()
while not client.check_twitter_auth():
    print("Client is not authorized")
    client.oob_auth()
    client.config.write()
confirmed = False
while not confirmed:
    (message, signed_message) = client.set_message()
    confirmed = confirm_messages(message, client.user_string, signed_message)
client.set_status(message, signed_message)
