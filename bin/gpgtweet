#!/usr/bin/env python

from gpgtweet.client import client 

def confirm(prompt='Confirm', resp=False):

    prompt = '%s [%s]|%s: ' % (prompt, 'n', 'y')
    if resp:
        prompt = '%s [%s]|%s: ' % (prompt, 'y', 'n')

    while True:
        ans = raw_input(prompt)
        if not ans:
            return resp
        if ans not in ['y', 'Y', 'n', 'N']:
            print("please enter y or n.")
            continue
        if ans == 'y' or ans == 'Y':
            return True
        if ans == 'n' or ans == 'N':
            return False

def confirm_messages(message, signed_message):
    print("\nTweet:\n%s\n\nSigned Message:\n%s\n" % (message, signed_message))
    return confirm(prompt="Confirm and Send?")

client = client.GPGTweetClient()
while not client.check_twitter_auth():
    print("Client is not authorized")
    client.oob_auth()
    client.config.write()
confirmed = False
while not confirmed:
    (message, signed_message) = client.set_message()
    confirmed = confirm_messages(message, signed_message)
client.set_status(message, signed_message)
